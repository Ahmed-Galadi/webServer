# ============================================================================
# Webserv Configuration - POST Request Testing
# ============================================================================

# ============================================================================
# Server 1: Main Testing Server (Port 8080)
# Purpose: Comprehensive POST testing with both CGI and C++ handlers
# ============================================================================
server {
    host 0.0.0.0 ;
    port 8080 ;
    client_max_body_size 1g ;
    root www ;  # ← Default root for server
    
    error_page 404 /error/404.html ;
    error_page 405 /error/405.html ;
    error_page 500 /error/500.html ;
    
    # ========================================
    # CGI scripts
    # ========================================
    location /cgi-bin/ {
        root www/cgi-bin/ ;
        methods GET POST ;
        index TI.html ;
        autoindex on ;
        cgi on ;
    }

    # ========================================
    # Browse uploaded files
    # URI: /upload/ → File: www/upload/index.html
    # ========================================
    location /upload/ {
        root www/upload ;              # Root is www
        index index.html ;      # So /upload/ → www/upload/index.html
        methods GET DELETE ;
        autoindex on ; # Enable autoindex for upload directory
        cgi on ;
    }

    # Example: Disable autoindex (default)
    location /private/ {
        root www ;
        methods GET ;
        autoindex off ;  # ← Disable directory listing
        cgi off ;
    }
    
    # ========================================
    # Upload endpoints (C++ POST handler)
    # ========================================
    location /upload {
        root www ;              # Root is www
        methods POST ;
        cgi off ;
    }
    
    # ========================================
    # Form submission endpoints
    # ========================================
    location /form-submit {
        root www ;
        methods POST ;
        cgi off ;
    }
    
    location /api/ {
        root www ;
        methods GET POST DELETE ;
        cgi off ;
    }
    
    location /text-submit {
        root www ;
        methods POST ;
        cgi off ;
    }
    
    # ========================================
    # Main site (catch-all, must be last)
    # ========================================
    location / {
        root www ;
        index index.html ;
        methods GET POST DELETE ;
        cgi off ;
    }
}

# ============================================================================
# Server 2: CGI-Only Testing Server (Port 4040)
# Purpose: Isolated CGI testing and form processing
# ============================================================================
server {
    host 127.0.0.1 ;
    port 4040 ;
    root www ;
    
    error_page 404 /error/404.html ;
    error_page 500 /error/500.html ;
    
    # CGI scripts location
    location /cgi-bin/ {
        root www ;
        methods GET POST ;
        cgi on ;
    }
    
    # Serve CGI test pages
    location / {
        root www ;
        index index.html ;
        methods GET ;
        cgi off ;
    }
}

# ============================================================================
# Server 3: C++ Handler Only (Port 3000)
# Purpose: Test C++ POST handlers without CGI interference
# ============================================================================
server {
    host 0.0.0.0 ;
    port 3000 ;
    client_max_body_size 5242880 ;  # 5MB max
    root www ;
    
    error_page 404 /error/404.html ;
    error_page 500 /error/500.html ;
    
    # All uploads via C++ handler
    location /upload {
        root www ;
        methods POST ;
        cgi off ;
    }
    
    # Form data testing
    location /form {
        root www ;
        methods POST ;
        cgi off ;
    }
    
    # JSON API testing
    location /api/ {
        root www ;
        methods GET POST DELETE ;
        cgi off ;
    }
    
    # Static files
    location / {
        root www ;
        index index.html ;
        methods GET POST DELETE ;
        cgi off ;
    }
    
    # View uploads
    location /upload/ {
        root www ;
        methods GET DELETE ;
        cgi off ;
    }
}
